FROM debian:latest

RUN apt-get update && apt-get install -y \
  autoconf \
  ca-certificates \
  libcurl4-gnutls-dev \
  pkg-config \
  libssl-dev \
  wget \
  curl \
  libc-client2007e-dev \
  libbz2-dev \
  libjpeg-dev \
  libmcrypt-dev \
  libxslt1-dev \
  libxslt1.1 \
  libpq-dev \
  libzip-dev \
  libzip4 \
  libreadline-dev \
  libreadline7 \
  build-essential \
  git \
  make

RUN wget http://php.net/distributions/php-7.0.28.tar.gz
RUN tar xvf php-7.0.28.tar.gz
RUN ./php-7.0.28/configure --prefix=/opt/php-7.0.28 \
    --enable-bcmath \
    --enable-fpm \
    --with-fpm-user=www-data \
    --with-fpm-group=www-data \
    --enable-mbstring \
    --enable-phpdbg \
    --enable-shmop \
    --enable-sockets \
    --enable-sysvmsg \
    --enable-sysvsem \
    --enable-sysvshm \
    --enable-zip \
    --with-libzip=/usr/lib/x86_64-linux-gnu \
    --with-zlib \
    --with-curl \
    --with-pear \
    --with-openssl \
    --enable-pcntl \
    --enable-mailparse \
    --with-readline

RUN make
RUN make install
RUN cp ./php-7.0.28/php.ini-production /opt/php-7.0.28/lib/php.ini

ENV PATH="/opt/php-7.0.28/bin/:${PATH}"

RUN php -i| grep mailparse 

RUN php -v
RUN pecl install mailparse

RUN echo 'extension=mailparse.so' >> /opt/php-7.0.28/lib/php.ini

RUN php -i| grep mailparse 

RUN php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');"
RUN php -r "if (hash_file('SHA384', 'composer-setup.php') === '544e09ee996cdf60ece3804abc52599c22b1f40f4323403c44d44fdfdd586475ca9813a858088ffbc1f233e9b180f061') { echo 'Installer verified'; } else { echo 'Installer corrupt'; unlink('composer-setup.php'); } echo PHP_EOL;"
RUN php composer-setup.php
RUN php -r "unlink('composer-setup.php');"
